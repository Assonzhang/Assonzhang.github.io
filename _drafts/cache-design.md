---
layout: post
title: 记一种不错的缓存设计思路
categories: Java
description: 一种不错的缓存设计思路。
keywords: Redis
---

今天与同事讨论接口性能问题时听他介绍了一种缓存设计思路，觉得不错，做个记录供以后参考。

## 背景

假设有个以下格式的接口：

```
GET /api?keys={key1,key2,key3,...}&types={1,2,3,...}
```

其中 keys 是业务主键列表，types 是想要取到的信息的类型。

请求该接口需要返回业务主键列表对应的业务对象列表，对象里需要包含指定类型的信息。

业务主键可能的取值较多，千万量级，type 取值范围为 1-10，可以任意组合，每种 type 对应到数据库是 1-N 张表。

现在设想这个接口遇到了性能瓶颈，打算添加 Redis 缓存来改善响应速度，应该如何设计？

## 设计思路

如果用请求的所有参数作为缓存 key，那组合情况太多了，缓存容量会非常大，而且命中率比较低。

这里就直接介绍上面提到的我觉得不错的思路了。

简单描述一下就是：

1. 使用 `业务主键:表名` 作为缓存 key；
2. 查询时，先根据查询参数 keys，以及 types 对应的表，得到所有 `key1:tb_1_1`、`key1:tb_1_2` 这样的组合，使用 Redis 的 mget 命令，批量取到所有缓存中存在的信息，剩下没有命中的，批量到数据库里查询，并放入缓存；
